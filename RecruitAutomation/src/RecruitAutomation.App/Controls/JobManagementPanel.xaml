<UserControl x:Class="RecruitAutomation.App.Controls.JobManagementPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1000"
             Background="#F5F5F5">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Row 0: Account Selection -->
        <Border Grid.Row="0" Background="White" Padding="15,10" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="选择账号：" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>
                <ComboBox x:Name="cmbAccounts" Width="200" Height="32" SelectionChanged="CmbAccounts_SelectionChanged">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Width="8" Height="8" Margin="0,0,8,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsAvailable}" Value="True">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock Text="{Binding DisplayName}"/>
                                <TextBlock Text=" - " Foreground="Gray"/>
                                <TextBlock Text="{Binding Platform}" Foreground="Gray"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <Button x:Name="btnRefreshAccounts" Content="🔄" Width="32" Height="32" Margin="5,0,0,0" ToolTip="刷新账号列表" Click="BtnRefreshAccounts_Click"/>
                <Button x:Name="btnFetchJobs" Content="📥 读取岗位" Height="32" Padding="15,0" Margin="20,0,0,0" Background="#2196F3" Foreground="White" BorderThickness="0" Click="BtnFetchJobs_Click" IsEnabled="False"/>
                <Button x:Name="btnCancel" Content="⏹ 取消" Height="32" Padding="15,0" Margin="10,0,0,0" Background="#F44336" Foreground="White" BorderThickness="0" Click="BtnCancel_Click" Visibility="Collapsed"/>
            </StackPanel>
        </Border>

        <!-- Row 1: DEBUG MODE PANEL - ALWAYS VISIBLE - ORANGE BACKGROUND -->
        <Border Grid.Row="1" Background="#FF9800" Padding="15,12" BorderBrush="#E65100" BorderThickness="0,0,0,3">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Debug Title and Buttons -->
                <StackPanel Grid.Row="0" Orientation="Horizontal">
                    <TextBlock Text="🔧 调试模式 (DEBUG BUILD)" FontWeight="Bold" FontSize="14" Foreground="White" VerticalAlignment="Center" Margin="0,0,20,0"/>
                    
                    <Button x:Name="btnDebugOpenBrowser" Content="🌐 打开浏览器窗口" Height="30" Padding="12,0" Margin="0,0,8,0" Background="#4CAF50" Foreground="White" FontWeight="Bold" BorderThickness="0" Click="BtnDebugOpenBrowser_Click"/>
                    <Button x:Name="btnDebugGoToJobPage" Content="📋 进入职位管理页" Height="30" Padding="12,0" Margin="0,0,8,0" Background="#2196F3" Foreground="White" FontWeight="Bold" BorderThickness="0" Click="BtnDebugGoToJobPage_Click"/>
                    <Button x:Name="btnDebugReadJobs" Content="🔍 开始读取职位(调试)" Height="30" Padding="12,0" Margin="0,0,8,0" Background="#9C27B0" Foreground="White" FontWeight="Bold" BorderThickness="0" Click="BtnDebugReadJobs_Click"/>
                    <Button x:Name="btnDebugScreenshot" Content="📷 截图当前页面" Height="30" Padding="12,0" Margin="0,0,8,0" Background="#607D8B" Foreground="White" FontWeight="Bold" BorderThickness="0" Click="BtnDebugScreenshot_Click"/>
                </StackPanel>
                
                <!-- Debug Info Text -->
                <Border Grid.Row="1" Background="#FFF3E0" CornerRadius="4" Padding="10,8" Margin="0,10,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock x:Name="txtDebugInfo" Grid.Column="0" Text="调试信息：等待操作..." Foreground="#E65100" FontSize="12" TextWrapping="Wrap"/>
                        <TextBlock Grid.Column="1" Text="Build: DEBUG-JOB-READER-v1" Foreground="#795548" FontSize="10" VerticalAlignment="Bottom"/>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Row 2: Status/Progress Bar -->
        <Border Grid.Row="2" x:Name="statusBar" Background="#E3F2FD" Padding="15,8" Visibility="Collapsed">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="txtStatus" Text="正在读取岗位..." VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" x:Name="progressBar" Width="200" Height="8" Minimum="0" Maximum="100" Value="0"/>
            </Grid>
        </Border>

        <!-- Row 3: Debug Log Output -->
        <Border Grid.Row="3" Background="#263238" Padding="10" MaxHeight="120">
            <ScrollViewer x:Name="debugLogScroller" VerticalScrollBarVisibility="Auto">
                <TextBlock x:Name="txtDebugLog" Text="[调试日志输出区域]&#x0a;等待操作..." Foreground="#4CAF50" FontFamily="Consolas" FontSize="11" TextWrapping="Wrap"/>
            </ScrollViewer>
        </Border>

        <!-- Row 4: Job List DataGrid -->
        <DataGrid Grid.Row="4" x:Name="dgJobs" Margin="15,10,15,10" 
                  AutoGenerateColumns="False" IsReadOnly="True"
                  SelectionMode="Extended" SelectionUnit="FullRow"
                  CanUserAddRows="False" CanUserDeleteRows="False"
                  GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                  Background="White" BorderBrush="#E0E0E0" BorderThickness="1" RowHeight="40">
            <DataGrid.Columns>
                <DataGridTemplateColumn Width="40">
                    <DataGridTemplateColumn.Header>
                        <CheckBox x:Name="chkSelectAll" Click="ChkSelectAll_Click"/>
                    </DataGridTemplateColumn.Header>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="平台" Binding="{Binding Platform}" Width="60"/>
                <DataGridTextColumn Header="岗位名称" Binding="{Binding Title}" Width="*" MinWidth="120"/>
                <DataGridTextColumn Header="薪资" Binding="{Binding SalaryText}" Width="90"/>
                <DataGridTextColumn Header="地点" Binding="{Binding Location}" Width="80"/>
                <DataGridTextColumn Header="经验" Binding="{Binding ExperienceRequired}" Width="70"/>
                <DataGridTextColumn Header="学历" Binding="{Binding EducationRequired}" Width="60"/>
                <DataGridTemplateColumn Header="状态" Width="60">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Background="#E8F5E9" CornerRadius="3" Padding="4,2">
                                <TextBlock Text="开放中" Foreground="#4CAF50" FontSize="10" HorizontalAlignment="Center"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="自动化" Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ToggleButton IsChecked="{Binding AutomationEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Click="AutomationToggle_Click" Width="32" Height="16">
                                <ToggleButton.Style>
                                    <Style TargetType="ToggleButton">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ToggleButton">
                                                    <Border x:Name="border" Background="#BDBDBD" CornerRadius="8" Width="32" Height="16">
                                                        <Ellipse x:Name="dot" Width="12" Height="12" Fill="White" HorizontalAlignment="Left" Margin="2,0"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsChecked" Value="True">
                                                            <Setter TargetName="border" Property="Background" Value="#4CAF50"/>
                                                            <Setter TargetName="dot" Property="HorizontalAlignment" Value="Right"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ToggleButton.Style>
                            </ToggleButton>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="读取时间" Binding="{Binding FetchedAtText}" Width="90"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Row 5: Bottom Stats and Actions -->
        <Border Grid.Row="5" Background="White" Padding="15,10" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal">
                    <TextBlock x:Name="txtStats" Text="共 0 个岗位，0 个已启用自动化" VerticalAlignment="Center"/>
                    <TextBlock Text=" | " Foreground="Gray" VerticalAlignment="Center" Margin="10,0"/>
                    <TextBlock x:Name="txtSelectedStats" Text="已选择 0 个" VerticalAlignment="Center"/>
                    <TextBlock Text=" | " Foreground="Gray" VerticalAlignment="Center" Margin="10,0"/>
                    <TextBlock Text="Build: DEBUG-JOB-READER-v1" Foreground="#9E9E9E" FontSize="10" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="批量启用" Height="28" Padding="12,0" Margin="0,0,8,0" Background="#4CAF50" Foreground="White" BorderThickness="0" Click="BtnBatchEnable_Click"/>
                    <Button Content="批量禁用" Height="28" Padding="12,0" Margin="0,0,8,0" Background="#FF9800" Foreground="White" BorderThickness="0" Click="BtnBatchDisable_Click"/>
                    <Button Content="删除选中" Height="28" Padding="12,0" Background="#F44336" Foreground="White" BorderThickness="0" Click="BtnDeleteSelected_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
